{% extends "base.html" %}

{% block content %}
<h2>ğŸ“‚ í”„ë¡œì íŠ¸ íŒŒì¼ ì—…ë¡œë“œ</h2>

<!-- âœ… ì—…ë¡œë“œ í´ë” í…Œì´ë¸” -->
<h3>ğŸ“ ì—…ë¡œë“œëœ í´ë” ëª©ë¡</h3>

{% if date_folders %}
<form id="delete-form">
    <table border="1">
        <thead>
            <tr>
                <th></th>
                {% for date in date_folders %}
                <th><input type="checkbox" class="column-checkbox" value="{{ date }}"></th>
                {% endfor %}
            </tr>

            <tr>
                <th>ì¸µ</th>
                {% for date in date_folders %}
                <th>{{ date }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for floor in floor_folders  %}
            <tr>
                <td>{{ floor }}</td>
                {% for date, folders in folder_structure.items %}
                <td>
                    {% if floor in folders %}
                        âœ…
                    {% else %}
                        âŒ
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="button" id="delete-selected">ì„ íƒí•œ í´ë” ì‚­ì œ</button>
</form>
{% else %}
ì—…ë¡œë“œëœ í´ë” ì—†ìŒ
{% endif %}

<h2>ZIP íŒŒì¼ ì—…ë¡œë“œ</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">ì—…ë¡œë“œ</button>
</form>

<a href="{% url 'project-list' %}" class="btn btn-secondary">ëŒì•„ê°€ê¸°</a>

<script>
document.getElementById("delete-selected").addEventListener("click", function() {
    let selectedFolders = [];
    document.querySelectorAll(".column-checkbox:checked").forEach(checkbox => {
        selectedFolders.push(checkbox.value);
    });

    if (selectedFolders.length === 0) {
        alert("ì‚­ì œí•  í´ë”ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
        return;
    }

    fetch("{% url 'delete-selected-folders' project.id %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: new URLSearchParams({ "folders[]": selectedFolders })
    })
    .then(response => response.json())
    .then(data => {
        if (data.deleted) {
            alert("ì‚­ì œ ì™„ë£Œ: " + data.deleted.join(", "));
            location.reload();
        }
    })
    .catch(error => console.error("Error:", error));
});
</script>
    
{% endblock %}
